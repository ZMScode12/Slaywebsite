<!DOCTYPE html>
<html>
<head>
  <title>Dynamic To-Do Tabs 😎</title>
  <style>
    :root {
      --default-moving: linear-gradient(135deg, #5b00ff, #ff0066, #00f2ff);
    }

    body {
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
      padding: 40px;
      transition: background 0.6s ease;
      background: var(--default-moving);
      background-size: 400% 400%;
      animation: gradientMove 12s ease infinite;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .hidden { display: none; }
    input, button { padding: 10px; margin: 6px; border-radius: 8px; border: none; font-size: 15px; }
    button { cursor: pointer; }
    .list-button { background-color: white; color: #6b5bff; }

    ul { list-style: none; padding: 0; margin-top: 10px; }
    li {
      margin: 10px;
      background: rgba(255,255,255,0.14);
      padding: 10px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    input[type="text"] { flex: 1; margin-left: 10px; border-radius:6px; padding:8px; border:none; }

    /* Gradient picker */
    .gradient-option {
      width: 86px;
      height: 44px;
      border-radius: 10px;
      display: inline-block;
      margin: 6px;
      cursor: pointer;
      border: 3px solid transparent;
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    }
    .gradient-option.selected {
      border-color: white;
      transform: translateY(-3px);
    }

    /* Tabs style */
    .tabs { margin-bottom: 18px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; }
    .tab-btn { background: rgba(255,255,255,0.12); color: white; border-radius: 12px; padding: 8px 12px; cursor: pointer; display:inline-flex; align-items:center; gap:6px; border: none; }
    .tab-btn.active { background: white; color: #6b5bff; font-weight:600; box-shadow: 0 8px 24px rgba(0,0,0,0.25); }

    .control-small { padding:6px 8px; font-size:14px; border-radius:8px; }
  </style>
</head>
<body>

  <!-- Sign up / Login -->
  <div id="signup">
    <h1>Sign Up 💫</h1>
    <input type="text" id="username" placeholder="Enter a username"><br>
    <input type="password" id="password" placeholder="Enter a password"><br>

    <p style="margin-top:8px">Pick your background style (or keep the moving default):</p>
    <div id="gradients">
      <div class="gradient-option" data-bg="linear-gradient(to right, #ff7e5f, #feb47b)" style="background: linear-gradient(to right, #ff7e5f, #feb47b)" title="Sunset"></div>
      <div class="gradient-option" data-bg="linear-gradient(to right, #2193b0, #6dd5ed)" style="background: linear-gradient(to right, #2193b0, #6dd5ed)" title="Ocean"></div>
      <div class="gradient-option" data-bg="linear-gradient(to right, #0f2027, #203a43, #2c5364)" style="background: linear-gradient(to right, #0f2027, #203a43, #2c5364)" title="Galaxy"></div>
      <div class="gradient-option" data-bg="linear-gradient(to right, #ff9a9e, #fad0c4)" style="background: linear-gradient(to right, #ff9a9e, #fad0c4)" title="Blossom"></div>
      <!-- "Don't change" option = keep moving default -->
      <div class="gradient-option" data-bg="default" id="defaultOption" style="background: linear-gradient(135deg,#5b00ff,#ff0066,#00f2ff)" title="Keep moving gradient"> </div>
    </div>
    <div style="margin-top:8px">
      <button onclick="createAccount()">Create Account</button>
      <button class="control-small" onclick="useDefaultNow()">Don't change — keep moving</button>
    </div>

    <p style="margin-top:12px">Already have an account? <a href="#" onclick="showLogin()">Log in</a></p>
  </div>

  <div id="login" class="hidden">
    <h1>Login 💫</h1>
    <input type="text" id="loginUsername" placeholder="Enter username"><br>
    <input type="password" id="loginPassword" placeholder="Enter password"><br>
    <div style="margin-top:8px">
      <button onclick="login()">Log In</button>
      <button class="control-small" onclick="showSignup()">Sign up</button>
    </div>
  </div>

  <!-- To-do lists -->
  <div id="todo" class="hidden">
    <div id="todoHeader"></div> <!-- Dynamic welcome + New List -->
    <div class="tabs" id="tabsContainer"></div> <!-- List tabs -->
    <div id="listsContainer"></div> <!-- Tasks for active tab -->
    <div style="margin-top:12px">
      <button onclick="logout()">Logout</button>
    </div>
  </div>

<script>
/* --------- State --------- */
let currentUser = localStorage.getItem('currentUser');
let allLists = [];               // array of { name: string, tasks: [{text,done}] }
let activeListIndex = 0;
let pickedBackground = 'default'; // 'default' keeps moving gradient, otherwise a CSS gradient string

/* --------- Helpers for gradients UI --------- */
const gradientEls = Array.from(document.querySelectorAll('.gradient-option'));
function setPickedBgValue(val) {
  pickedBackground = val;
  // update visual selection
  gradientEls.forEach(el => el.classList.toggle('selected', el.getAttribute('data-bg') === val));
  // preview it immediately
  applyBackgroundPreview(val);
}
function applyBackgroundPreview(val) {
  if (val === 'default') {
    document.body.style.background = getComputedStyle(document.documentElement).getPropertyValue('--default-moving').trim();
    document.body.style.backgroundSize = '400% 400%';
    document.body.style.animation = 'gradientMove 12s ease infinite';
  } else {
    document.body.style.background = val;
    document.body.style.backgroundSize = '';
    document.body.style.animation = '';
  }
}
// wire up clicks
gradientEls.forEach(el => el.addEventListener('click', () => {
  setPickedBgValue(el.getAttribute('data-bg'));
}));

// "Don't change" quick button (preview + select default)
function useDefaultNow() {
  setPickedBgValue('default');
}

/* Initialize signup preview — default selected */
setPickedBgValue('default');

/* --------- Load existing session --------- */
if (currentUser) {
  showTodo();
  loadAllLists();
}

/* --------- Account functions --------- */
function createAccount() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if (!user || !pass) { alert('Please fill both username and password'); return; }

  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if (users[user]) { alert('Username exists'); return; }

  // create with one default list object (with name + tasks)
  users[user] = {
    password: pass,
    lists: [{ name: 'My First List', tasks: [] }],
    background: pickedBackground // either 'default' or a gradient string
  };
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', user);
  currentUser = user;
  loadAllLists();
  showTodo();
  renderLists();
}

function showLogin() {
  document.getElementById('signup').classList.add('hidden');
  document.getElementById('login').classList.remove('hidden');
}

function showSignup() {
  document.getElementById('login').classList.add('hidden');
  document.getElementById('signup').classList.remove('hidden');
}

function login() {
  const user = document.getElementById('loginUsername').value.trim();
  const pass = document.getElementById('loginPassword').value.trim();
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if (!users[user] || users[user].password !== pass) {
    alert('Invalid username or password');
    return;
  }
  localStorage.setItem('currentUser', user);
  currentUser = user;
  loadAllLists();
  showTodo();
  renderLists();
}

/* --------- show/hide and background application --------- */
function showTodo() {
  // load user data and apply their background
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if (!currentUser || !users[currentUser]) return;

  const user = users[currentUser];
  const bg = user.background || 'default';
  applyBackgroundPreview(bg);

  document.getElementById('signup').classList.add('hidden');
  document.getElementById('login').classList.add('hidden');
  document.getElementById('todo').classList.remove('hidden');

  document.getElementById('todoHeader').innerHTML = `
  <h1>Welcome, ${currentUser}!</h1>
  <button onclick="createNewList()" class="list-button">+ New To-Do List</button>
  <button onclick="changeBackground()" class="list-button">Change Background</button>
`;
function changeBackground() {
  const choice = prompt(
    "Enter a background type:\n1. Color\n2. Gradient\n3. Keep Moving Gradient\n(e.g., 'red', 'linear-gradient(#ff6eb4, #6b5bff)', or 'default')"
  );

  const body = document.body;

  if (!choice) return;

  if (choice.toLowerCase() === 'default') {
    body.style.background = "linear-gradient(135deg, #6b5bff, #ff6eb4, #00d2ff)";
    body.style.backgroundSize = "400% 400%";
    body.style.animation = "gradientMove 15s ease infinite";
  } else {
    body.style.background = choice;
    body.style.backgroundSize = "";
    body.style.animation = "";
  }
}

/* let users change background after signup/login */
function openBackgroundPicker() {
  // show the signup area so they can pick — but keep data
  document.getElementById('todo').classList.add('hidden');
  document.getElementById('signup').classList.remove('hidden');
  // pre-select the user's current background in the UI
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  const bg = (users[currentUser] && users[currentUser].background) || 'default';
  setPickedBgValue(bg);
}

/* logout */
function logout() {
  // save current lists first
  saveAllLists();
  localStorage.removeItem('currentUser');
  currentUser = null;
  allLists = [];
  activeListIndex = 0;
  // restore default moving gradient preview
  setPickedBgValue('default');
  document.getElementById('todo').classList.add('hidden');
  document.getElementById('login').classList.remove('hidden');
  document.getElementById('listsContainer').innerHTML = "";
  document.getElementById('tabsContainer').innerHTML = "";
  document.getElementById('todoHeader').innerHTML = "";
}

/* --------- Save / Load user lists --------- */
function saveAllLists() {
  if (!currentUser) return;
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[currentUser].lists = allLists;
  // keep background as-is
  localStorage.setItem('users', JSON.stringify(users));
}

function loadAllLists() {
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if (!currentUser || !users[currentUser]) { allLists = []; return; }
  allLists = users[currentUser].lists || [];
  // ensure each list object has name and tasks keys (backwards compatibility)
  allLists = allLists.map(l => (typeof l === 'string' ? { name: l, tasks: [] } : (l.name ? l : { name: 'Untitled', tasks: l.tasks || [] })));
  activeListIndex = 0;
}

/* --------- Render Tabs & Lists --------- */
function renderLists() {
  renderTabs();
  renderActiveList();
}

function renderTabs() {
  const tabs = document.getElementById('tabsContainer');
  tabs.innerHTML = "";
  allLists.forEach((list, i) => {
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (i === activeListIndex ? ' active' : '');
    btn.textContent = list.name || `List ${i+1}`;
    btn.onclick = () => { activeListIndex = i; renderLists(); };
    tabs.appendChild(btn);

    // rename button
    const renameBtn = document.createElement('button');
    renameBtn.className = 'control-small';
    renameBtn.textContent = '✏️';
    renameBtn.onclick = (e) => { e.stopPropagation(); renameList(i); };
    tabs.appendChild(renameBtn);

    // delete button
    const delBtn = document.createElement('button');
    delBtn.className = 'control-small';
    delBtn.textContent = '🗑';
    delBtn.onclick = (e) => { e.stopPropagation(); confirmDeleteList(i); };
    tabs.appendChild(delBtn);
  });
}

function renderActiveList() {
  const container = document.getElementById('listsContainer');
  container.innerHTML = "";

  if (allLists.length === 0) {
    container.innerHTML = `<div style="padding:20px; border-radius:12px; background: rgba(0,0,0,0.15)">
      <h2>No To-Do Lists Yet 😎</h2>
      <p>Click "+ New To-Do List" to start.</p>
    </div>`;
    return;
  }

  const index = activeListIndex;
  const list = allLists[index];
  const listDiv = document.createElement('div');

  listDiv.innerHTML = `
    <h2 style="margin-bottom:6px">${list.name}</h2>
    <div style="margin-bottom:8px">
      <input type="text" id="newTask_${index}" placeholder="Add a task...">
      <button onclick="addTask(${index})">Add</button>
    </div>
    <ul id="list_${index}"></ul>
  `;
  container.appendChild(listDiv);

  const ul = document.getElementById(`list_${index}`);
  list.tasks.forEach((task, tIdx) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <input type="checkbox" ${task.done ? 'checked' : ''} onchange="toggleTask(${tIdx})">
      <input type="text" value="${escapeHtml(task.text)}" onchange="editTask(${tIdx}, this.value)">
      <button onclick="deleteTask(${tIdx})">🗑️</button>
    `;
    ul.appendChild(li);
  });
}

/* --------- List & Task operations --------- */
function createNewList() {
  const name = `List ${allLists.length + 1}`;
  allLists.push({ name, tasks: [] });
  saveAllLists();
  activeListIndex = allLists.length - 1;
  renderLists();
}

function renameList(listIndex) {
  const currentName = allLists[listIndex].name || `List ${listIndex+1}`;
  const newName = prompt("Enter a new name for this list:", currentName);
  if (newName && newName.trim() !== "") {
    allLists[listIndex].name = newName.trim();
    saveAllLists();
    renderLists();
  }
}

function confirmDeleteList(listIndex) {
  if (!confirm("Are you sure you want to delete this list and all its tasks?")) return;
  allLists.splice(listIndex, 1);
  if (allLists.length === 0) activeListIndex = 0;
  else if (activeListIndex >= allLists.length) activeListIndex = allLists.length - 1;
  saveAllLists();
  renderLists();
}

function addTask(listIndex) {
  const input = document.getElementById(`newTask_${listIndex}`);
  const text = input.value.trim();
  if (!text) return;
  allLists[listIndex].tasks.push({ text, done: false });
  input.value = "";
  saveAllLists();
  renderLists();
}

function toggleTask(taskIndex) {
  const list = allLists[activeListIndex];
  list.tasks[taskIndex].done = !list.tasks[taskIndex].done;
  saveAllLists();
  renderLists();
}

function editTask(taskIndex, newText) {
  allLists[activeListIndex].tasks[taskIndex].text = newText;
  saveAllLists();
}

function deleteTask(taskIndex) {
  allLists[activeListIndex].tasks.splice(taskIndex, 1);
  saveAllLists();
  renderLists();
}

/* --------- Small util --------- */
function escapeHtml(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
</script>
</body>
</html>
