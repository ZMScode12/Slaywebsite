<!DOCTYPE html>
<html>
<head>
  <title>Dynamic To-Do Tabs üòé</title>
  <style>
    :root { --default-moving: linear-gradient(135deg, #5b00ff, #ff0066, #00f2ff); }

    body {
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
      padding: 40px;
      transition: background 0.6s ease;
      background: var(--default-moving);
      background-size: 400% 400%;
      animation: gradientMove 12s ease infinite;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .hidden { display: none; }
    input, button { padding: 10px; margin: 6px; border-radius: 8px; border: none; font-size: 15px; }
    button { cursor: pointer; }
    .list-button { background-color: white; color: #6b5bff; }

    ul { list-style: none; padding: 0; margin-top: 10px; }
    li { margin: 10px; background: rgba(255,255,255,0.14); padding: 10px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    input[type="text"] { flex: 1; margin-left: 10px; border-radius:6px; padding:8px; border:none; }

    .gradient-option { width: 86px; height: 44px; border-radius: 10px; display: inline-block; margin: 6px; cursor: pointer; border: 3px solid transparent; box-shadow: 0 6px 18px rgba(0,0,0,0.18); }
    .gradient-option.selected { border-color: white; transform: translateY(-3px); }

    .tabs { margin-bottom: 18px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; }
    .tab-btn { background: rgba(255,255,255,0.12); color: white; border-radius: 12px; padding: 8px 12px; cursor: pointer; display:inline-flex; align-items:center; gap:6px; border: none; }
    .tab-btn.active { background: white; color: #6b5bff; font-weight:600; box-shadow: 0 8px 24px rgba(0,0,0,0.25); }

    .control-small { padding:6px 8px; font-size:14px; border-radius:8px; }

    /* Quick Links + Planner container */
    .side-panel {
      position: fixed;
      top: 60px;
      width: 260px;
      max-height: 70%;
      background: rgba(0,0,0,0.32);
      padding: 12px;
      border-radius: 12px;
      color: white;
      text-align: left;
      box-shadow: 0 8px 24px rgba(0,0,0,0.35);
      overflow-y: auto;
      z-index: 9999;
      transition: transform 0.3s ease;
    }

    .side-panel.hidden { display: none; }

    #quickLinks { left: 40px; transform: translateX(-100%); }
    #planner { right: 40px; transform: translateX(100%); }

    .side-panel.open { transform: translateX(0); }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .panel-header h3 { margin: 0; font-size:16px; }
    .panel-content { margin-top: 6px; display: none; flex-direction: column; gap:6px; }
    .panel-content input { width: 100%; border-radius: 8px; padding:8px; margin:0; border:none; box-sizing:border-box; }
    .panel-content .row { display:flex; gap:6px; }
    .panel-content .row input { flex:1; }

  </style>
</head>
<body>

  <!-- Sign up / Login -->
  <div id="signup">
    <h1>Sign Up üí´</h1>
    <input type="text" id="username" placeholder="Enter a username"><br>
    <input type="password" id="password" placeholder="Enter a password"><br>

    <p style="margin-top:8px">Pick your background style (or keep the moving default):</p>
    <div id="gradients">
      <div class="gradient-option" data-bg="linear-gradient(to right, #ff7e5f, #feb47b)" style="background: linear-gradient(to right, #ff7e5f, #feb47b)" title="Sunset"></div>
      <div class="gradient-option" data-bg="linear-gradient(to right, #2193b0, #6dd5ed)" style="background: linear-gradient(to right, #2193b0, #6dd5ed)" title="Ocean"></div>
      <div class="gradient-option" data-bg="linear-gradient(to right, #0f2027, #203a43, #2c5364)" style="background: linear-gradient(to right, #0f2027, #203a43, #2c5364)" title="Galaxy"></div>
      <div class="gradient-option" data-bg="linear-gradient(to right, #ff9a9e, #fad0c4)" style="background: linear-gradient(to right, #ff9a9e, #fad0c4)" title="Blossom"></div>
      <div class="gradient-option" data-bg="default" id="defaultOption" style="background: linear-gradient(135deg,#5b00ff,#ff0066,#00f2ff)" title="Keep moving gradient"></div>
    </div>
    <div style="margin-top:8px">
      <button onclick="createAccount()">Create Account</button>
      <button class="control-small" onclick="useDefaultNow()">Don't change ‚Äî keep moving</button>
    </div>

    <p style="margin-top:12px">Already have an account? <a href="#" onclick="showLogin()">Log in</a></p>
  </div>

  <div id="login" class="hidden">
    <h1>Login üí´</h1>
    <input type="text" id="loginUsername" placeholder="Enter username"><br>
    <input type="password" id="loginPassword" placeholder="Enter password"><br>
    <div style="margin-top:8px">
      <button onclick="login()">Log In</button>
      <button class="control-small" onclick="showSignup()">Sign up</button>
    </div>
  </div>

  <!-- To-do lists -->
  <div id="todo" class="hidden">
    <div id="todoHeader"></div> <!-- Dynamic welcome + New List -->
    <div class="tabs" id="tabsContainer"></div> <!-- List tabs -->
    <div id="listsContainer"></div> <!-- Tasks for active tab -->
    <div id="background-picker" class="hidden" style="margin-top:12px;">
      <label for="bg-select">Choose Background:</label>
      <select id="bg-select" onchange="changeBackground(this.value)">
        <option value="default">Default</option>
        <option value="linear-gradient(to right, #ff7e5f, #feb47b)">Sunset</option>
        <option value="linear-gradient(to right, #2193b0, #6dd5ed)">Ocean</option>
        <option value="linear-gradient(to right, #0f2027, #203a43, #2c5364)">Galaxy</option>
        <option value="linear-gradient(to right, #ff9a9e, #fad0c4)">Blossom</option>
      </select>
    </div>
    <div style="margin-top:12px">
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- Quick Links panel -->
  <div id="quickLinks" class="side-panel hidden" aria-hidden="true">
    <div class="panel-header" onclick="togglePanel('quickLinks')">
      <h3>Quick Links ‚¨áÔ∏è</h3>
    </div>
    <div class="panel-content" id="quickLinksContent">
      <ul id="quickLinksList"></ul>
      <input type="text" id="quickLinkName" placeholder="Link name (e.g. Spotify)">
      <input type="text" id="quickLinkURL" placeholder="URL (e.g. https://spotify.com)">
      <div class="row">
        <button class="small-btn" onclick="addQuickLink()">Add</button>
        <button class="small-btn" onclick="clearQuickLinks()">Clear All</button>
      </div>
    </div>
  </div>

  <!-- Planner panel -->
  <div id="planner" class="side-panel hidden" aria-hidden="true">
    <div class="panel-header" onclick="togglePanel('planner')">
      <h3>Planner ‚¨áÔ∏è</h3>
    </div>
    <div class="panel-content" id="plannerContent">
      <ul id="plannerList"></ul>
      <input type="text" id="plannerTask" placeholder="Add planner task">
      <div class="row">
        <button class="small-btn" onclick="addPlannerTask()">Add</button>
        <button class="small-btn" onclick="clearPlanner()">Clear All</button>
      </div>
    </div>
  </div>

<script>
/* --------- State --------- */
let currentUser = localStorage.getItem('currentUser'); 
let currentUserName = null; 
let allLists = [];
let activeListIndex = 0;
let pickedBackground = 'default';
let plannerTasks = [];

/* --------- Gradient selection --------- */
const gradientEls = Array.from(document.querySelectorAll('.gradient-option'));
function setPickedBgValue(val) {
  pickedBackground = val;
  gradientEls.forEach(el => el.classList.toggle('selected', el.getAttribute('data-bg') === val));
  applyBackgroundPreview(val);
}
function applyBackgroundPreview(val) {
  if (val === 'default') {
    document.body.style.background = getComputedStyle(document.documentElement).getPropertyValue('--default-moving').trim();
    document.body.style.backgroundSize = '400% 400%';
    document.body.style.animation = 'gradientMove 12s ease infinite';
  } else {
    document.body.style.background = val;
    document.body.style.backgroundSize = '';
    document.body.style.animation = '';
  }
}
gradientEls.forEach(el => el.addEventListener('click', () => setPickedBgValue(el.getAttribute('data-bg'))));
function useDefaultNow() { setPickedBgValue('default'); }

/* --------- Panels --------- */
function togglePanel(panelId) {
  const panel = document.getElementById(panelId);
  const content = panel.querySelector('.panel-content');
  const open = content.style.display === 'flex';
  content.style.display = open ? 'none' : 'flex';
}

/* --------- Load session (if any) --------- */
if (currentUser) {
  const usersTemp = JSON.parse(localStorage.getItem('users') || '{}');
  if (usersTemp[currentUser]) currentUserName = usersTemp[currentUser].username || null;
  showTodo();
  loadAllLists();
  renderQuickLinks();
  loadPlanner();
}

/* --------- Account functions --------- */
function createAccount() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if (!user || !pass) { alert('Please fill both username and password'); return; }

  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if (users[pass]) { alert('That password is already in use. Please pick a different password.'); return; }

  users[pass] = {
    username: user,
    password: pass,
    lists: [{ name: 'My First List', tasks: [] }],
    background: pickedBackground,
    quickLinks: [],
    planner: []
  };
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', pass);
  currentUser = pass;
  currentUserName = user;
  loadAllLists();
  showTodo();
  renderLists();
  renderQuickLinks();
  loadPlanner();
}

function login() {
  const userInput = document.getElementById('loginUsername').value.trim();
  const pass = document.getElementById('loginPassword').value.trim();
  const users = JSON.parse(localStorage.getItem('users') || '{}');

  if (!users[pass] || users[pass].username !== userInput) {
    alert('Invalid username or password');
    return;
  }

  localStorage.setItem('currentUser', pass);
  currentUser = pass;
  currentUserName = users[pass].username || null;
  loadAllLists();
  showTodo();
  renderLists();
  renderQuickLinks();
  loadPlanner();
}

function logout() {
  saveAllLists();
  savePlanner();
  localStorage.removeItem('currentUser');
  currentUser = null;
  currentUserName = null;
  allLists = [];
  activeListIndex = 0;
  plannerTasks = [];
  setPickedBgValue('default');
  document.getElementById('todo').classList.add('hidden');
  document.getElementById('listsContainer').innerHTML = "";
  document.getElementById('tabsContainer').innerHTML = "";
  document.getElementById('todoHeader').innerHTML = "";
  renderQuickLinks();
  loadPlanner();
}

/* --------- Quick Links --------- */
function renderQuickLinks() {
  const quickDiv = document.getElementById('quickLinks');
  const listEl = document.getElementById('quickLinksList');
  listEl.innerHTML = '';

  if (!currentUser) {
    quickDiv.classList.add('hidden');
    quickDiv.setAttribute('aria-hidden','true');
    return;
  }

  const users = JSON.parse(localStorage.getItem('users') || '{}');
  const links = (users[currentUser] && users[currentUser].quickLinks) || [];

  links.forEach((link, i) => {
    const li = document.createElement('li');
    const nameDisplay = link.name ? (link.name.length > 36 ? (link.name.slice(0,33) + '...') : link.name) : (link.url.length > 36 ? (link.url.slice(0,33) + '...') : link.url);
    li.innerHTML = `<a href="${escapeHtml(link.url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(nameDisplay)}</a>
      <div>
        <button class="small-btn" onclick="editQuickLink(${i})" title="Edit link">‚úèÔ∏è</button>
        <button class="small-btn" onclick="removeQuickLink(${i})" title="Remove link">üóë</button>
      </div>`;
    listEl.appendChild(li);
  });

  quickDiv.classList.remove('hidden');
  quickDiv.setAttribute('aria-hidden','false');
}

/* --------- Planner --------- */
function loadPlanner() {
  const plannerDiv = document.getElementById('planner');
  const ul = document.getElementById('plannerList');
  ul.innerHTML = '';

  if (!currentUser) {
    plannerDiv.classList.add('hidden');
    return;
  }

  const users = JSON.parse(localStorage.getItem('users') || '{}');
  plannerTasks = (users[currentUser] && users[currentUser].planner) || [];

  plannerTasks.forEach((task, i) => {
    const li = document.createElement('li');
    li.innerHTML = `${escapeHtml(task.text)}
      <button class="small-btn" onclick="removePlannerTask(${i})">üóë</button>`;
    ul.appendChild(li);
  });

  plannerDiv.classList.remove('hidden');
}

function addPlannerTask() {
  const input = document.getElementById('plannerTask');
  const text = input.value.trim();
  if (!text) return;

  plannerTasks.push({ text });
  savePlanner();
  input.value = '';
  loadPlanner();
}

function removePlannerTask(index) {
  plannerTasks.splice(index,1);
  savePlanner();
  loadPlanner();
}

function clearPlanner() {
  if (!confirm('Clear all planner tasks?')) return;
  plannerTasks = [];
  savePlanner();
  loadPlanner();
}

function savePlanner() {
  if (!currentUser) return;
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[currentUser].planner = plannerTasks;
  localStorage.setItem('users', JSON.stringify(users));
}

/* --------- Lists --------- */
function saveAllLists() {
  if (!currentUser) return;
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  users[currentUser].lists = allLists;
  localStorage.setItem('users', JSON.stringify(users));
}
function loadAllLists() {
  const users = JSON.parse(localStorage.getItem('users') || '{}');
  if (!currentUser || !users[currentUser]) { allLists = []; return; }
  allLists = users[currentUser].lists || [];
  allLists = allLists.map(l => (typeof l === 'string' ? { name: l, tasks: [] } : (l.name ? l : { name: 'Untitled', tasks: l.tasks || [] })));
  activeListIndex = 0;
}

/* Render */
function renderLists() {
  renderTabs();
  renderActiveList();
}
function renderTabs() {
  const tabs = document.getElementById('tabsContainer');
  tabs.innerHTML = "";
  allLists.forEach((list, i) => {
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (i === activeListIndex ? ' active' : '');
    btn.textContent = list.name || `List ${i+1}`;
    btn.onclick = () => { activeListIndex = i; renderLists(); };
    tabs.appendChild(btn);

    const closeBtn = document.createElement('button');
    closeBtn.className = 'small-btn';
    closeBtn.innerHTML = '‚úñ';
    closeBtn.onclick = (e) => { e.stopPropagation(); allLists.splice(i,1); if(activeListIndex>=allLists.length) activeListIndex = allLists.length-1; saveAllLists(); renderLists(); };
    tabs.appendChild(closeBtn);
  });

  const addBtn = document.createElement('button');
  addBtn.className = 'tab-btn';
  addBtn.textContent = '+ New List';
  addBtn.onclick = () => { allLists.push({name:'New List', tasks:[]}); activeListIndex=allLists.length-1; saveAllLists(); renderLists(); };
  tabs.appendChild(addBtn);
}
function renderActiveList() {
  const container = document.getElementById('listsContainer');
  container.innerHTML = '';
  if (!allLists[activeListIndex]) return;
  const list = allLists[activeListIndex];
  const ul = document.createElement('ul');
  list.tasks.forEach((task, i) => {
    const li = document.createElement('li');
    li.innerHTML = `<span>${escapeHtml(task)}</span><button class="small-btn" onclick="removeTask(${i})">üóë</button>`;
    ul.appendChild(li);
  });
  container.appendChild(ul);

  const input = document.createElement('input');
  input.type='text'; input.placeholder='Add a new task';
  input.addEventListener('keydown', e => { if(e.key==='Enter'){ addTask(input.value); input.value=''; } });
  container.appendChild(input);
}
function addTask(taskText) {
  if (!taskText || !allLists[activeListIndex]) return;
  allLists[activeListIndex].tasks.push(taskText);
  saveAllLists();
  renderActiveList();
}
function removeTask(i) {
  allLists[activeListIndex].tasks.splice(i,1);
  saveAllLists();
  renderActiveList();
}

/* Utility */
function escapeHtml(text) {
  const map = { '&': '&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#039;' };
  return text.replace(/[&<>"']/g, m => map[m]);
}

function showTodo() {
  document.getElementById('signup').classList.add('hidden');
  document.getElementById('login').classList.add('hidden');
  document.getElementById('todo').classList.remove('hidden');
  document.getElementById('todoHeader').innerHTML = `<h2>Welcome ${currentUserName || 'User'}!</h2>`;
}

function showLogin() { document.getElementById('signup').classList.add('hidden'); document.getElementById('login').classList.remove('hidden'); }
function showSignup() { document.getElementById('login').classList.add('hidden'); document.getElementById('signup').classList.remove('hidden'); }

</script>
</body>
</html>
